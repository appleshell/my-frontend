---
title: 读《渲染器》笔记
---

原文[《渲染器》](http://hcysun.me/vue-design/zh/)

## 组件本质

1. 一个组件就是一个函数，给到什么数据，就渲染出什么样的 html 内容。

2. 组件产出的是`virtual DOM`。之所以要产出`virtual DOM`，是因为`virtual DOM`带来分层设计

3. 我自己的理解，vnode 是一个对象，通常用 tag 属性表示组件，如果是字符串，就是 html 原生标签；否则就是组件。

4. 组件可分为函数组件和 有状态组件

它们的区别如下：

- 函数式组件：

  - 是一个纯函数
  - 没有自身状态，只接收外部数据
  - 产出 VNode 的方式：单纯的函数调用

- 有状态组件：

  - 是一个类，可实例化
  - 可以有自身状态
  - 产出 VNode 的方式：需要实例化，然后调用其 render 函数

> 结合 react 自己的理解：

在 react 中，函数组件直接调用，返回组件对象；class 组件实例化后调用 render 方法返回组件对象。其他在函数中或者 class 中的方法，都是为了处理渲染需要的数据。

jsx 被 babel 编译成`React.createElement()`方法，返回称为 react 元素的对象，根据这个对象生成 fiber 节点，这就是 react 中的 vnode。

## VNode 的设计

1. VNode 的种类

   ![vnode种类](http://hcysun.me/vue-design/assets/img/vnode-types.7d99313d.png)

   VNode 可以描述原生 html 元素，自定义组件，纯文本，Fragment，Portal

2. VNode 的属性

- tag，标识 VNode 的标签
- data，标识 VNode 的属性
- children，标识 VNode 的子节点
- flags，标识 VNode 的种类
- childrenFlags，标识子节点的种类

> 结合 react 自己的理解：

在 react 中 fiber 的结构与上述类似，通过一些属性来描述 fiber node 对应的元素。

[源码中的 fiber 节点构造函数](https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiber.new.js#L110)

[Fiber 的结构](https://react.iamkasong.com/process/fiber.html#fiber%E7%9A%84%E7%BB%93%E6%9E%84)，这篇文章解释了一些属性的含义。
